---
title: "Kafka "
excerpt: "Messsage Service"

categories:
  - Messaging
tags:
  - Messaging
classes: wide
last_modified_at: 2021-06-29T22:49:00-05:00
---

> 지나침은 미치지 못함과 같다.  

# 메시징 시스템

- Message Oriented Middleware : 메시지 지향 미들웨어 

 일반적으로 메시징 시스템이나 메시지 지향 미들웨어(MOM, Message Oriented Middlware) 라고 부르는 별도의 소프트웨어 시스템이 메시징 기능을 제공한다. 데이터 베이스 시스템이 데이터의 지속성을 관리하는 것처럼 메시징 시스템은 메시징을 관리한다. 애플리케이션이 데이터를 이용할 수 있게 하려면 관리자가 데이터베이스에 스키마를 생성해야 하는 것처럼, 관리자는 애플리케이션이 통신할 수 있게 메시징 시스템에 통신 경로인 채널을 구성해야한다. 
 메시징 시스템은 메시징 송수신을 관리하고 조정한다. 데이터 베이스 시스템의 주된 목적이 데이터 레코드를 안전하게 시족하는 것이듯이, 메시징 시스템의 주요 작업은 메시지를 발신자의 컴퓨터에서 신뢰할 수 있는 방식으로 수신자의 컴퓨터로 이동시키는 것이다. 
  
  - 생성 : 발신자는 메시지를 생성하고 데이터를 채운다. 
  - 발신 : 발신자는 메시지를 채널에 쓴다. 
  - 전달 : 메시징 시스템은 수신자가 사용할 수 있게 발신자의 컴퓨터에서 수신자 컴퓨터로 메시지를 이동시킨다. 
  - 수신 : 수신자는 채널에서 메시지를 읽는다. 
  - 처리 : 수신자는 메시지에서 데이터를 추출한다. 

- Messaging Systems 

  - Apache Kafka 
  - Google Pub/Sub
  - RabbitMQ


# Apache Kafka 

아파치 카프카의 활용 범위 ( Event Streaming )  

- 주식변화, 은행, 보험 등과 같이 실시간의 지불/금융 트랜잭션을 처리하기 위해서 
- 자동화 산업에서 실시간의 배송/차량,트럭,배송업체에 대한 모니터링 및 추적을 위해서 
- IOT 장비로 부터 센서 데이터를 지속적으로 분석하고, 보관하기 위해서 
- 모바일 어플리케이션, 여행 산업, 호텔, 도매에서 고객과의 상호작용과 주문에 즉각적으로 응답하고, 수집하기 위해서
- 병원에서 환자 관리를 위해서 

등등..  

### Event Streaming Platform 

 - 다른 시스템으로 부터의 우리의 데이터을 지속적으로 Export/Import 를 위한, 이벤트 스트림을 구독하고 배포하기 위해서 
 - 지속적이로 신뢰가능하게 이벤트 스트림을 저장하기 위해서 
 - 이벤트 스트림을 처리하기 위해서 


### Kafka의 대략적인 동작 방식 

고성능의 TCP Network Protocol을 통해 통신(상호작용)하는 서버와 클라이언트들로 구성된 분산된 시스템이다. 

#### Servers

Kafka는 다중 데이터 센터또는 클라우드 영역을 확장할 수 있도록 한개, 그 이상의 서버의 단위로서 운영된다. 그 중의 일부 서버는 브로커(Broker)라고 불리는 Storage Layer를 구성한다. 그외 서버는 Kafka Connect가 지속적으로 우리가 구성한 시스템에 적용된 Kafka를 통합하기 위한 이벤트 스트림 데이터를 import/export 하기위해서 운영한다. Mission-Critical , fault-tolerant를 구현하기 위함으로 만약 서버 하나가 장애가 생겼을 때, 다른 서버가 해당 서버가 하던 작업을 데이터 유실 없이 이어받아 동작할 것이다. 

#### Clients 

병렬적으로 이벤트 스트림을 처리하고, 쓰고, 읽는 마이크로 서비스 와 분산 어플리케이션을 만들 수 있도록 해주었다. 이 때 네트워크 문제, 기기 장애 등에 대한 장애 내성을 고려한다. Clients 로 사용 가능한 언어는 JAVA, Scala, Go, Python, C++/C 와 많은 프로그래밍 언어들이 있다. 

### Main Concepts and Terminology 

![](https://keepinmindsh.github.io/lines/assets/img/streams-and-tables-p1_p4.png){: .align-center}

- Event 

하나의 비즈니스 또는 세계에서 "무엇인가 일어나게되는" 이벤트이다. 데이터를 Kafka에 쓰거나 읽을 때, 하나의 이벤트를 구성한다. 
개념적으로 이벤트는 키, 값, 시간 그리고 메타데이터를 가지고 있다. 

- Producers

 이벤트를 카프카에 배포(쓰는)역할을 한다. 

- Consumers

 이벤트를 구독(읽는)하는 역할을 한다. 

- Topics

 이벤트는 구조화되고, 지속적으로 Topics 안에 저장된다. 

- Partitioned
- Replicated 


### Kafka APIs

- Admin API 

 topics, brokers와 다른 Kafka 오브젝트를 검사하고 관리하기 위해서 사용된다. 

- Producer API

 Event 스트림을 하나또는 그 이상의 Kafka Topics 배포하는 역학을 한다. 

- Consumer API 

하나, 하나이상의 topics 를 구독하고, 이벤트 스트림을 처리하기 위해서 사용한다. 

- Kafka Streams API

스트림 프로세싱 및 마이트로 서비스를 구현하기 위해서이다. 이벤트 스트림에 대해서 변환, 병합, 조인 등을 처리하기 위해서 
고 차원의 함수를 제공한다. 

- Kafka Connect API 


### Kafka Client로 지윈되는 목록 

- https://cwiki.apache.org/confluence/display/KAFKA/Clients


### Kafka의 기본 설정 

Kafka는 기본적으로 키/값의 쌍인 프로파티 파일로 구성되어 있다.

### Broker의 Config 설정 

https://kafka.apache.org/documentation/#brokerconfigs

### Topic Config 설정 

https://kafka.apache.org/documentation/#topicconfigs

### Producer Config 세팅 

https://kafka.apache.org/documentation/#producerconfigs

### Consumer Config 세팅 

https://kafka.apache.org/documentation/#consumerconfigs


# Zookeeper 

https://kafka.apache.org/documentation/#zkops  

### Zoopkeeper Cluster 샘플 구축 

3개의 인스턴스로 이루어진 클러스터 구축 하기  

```

initLimit=5 
syncLimit=2 

# server.#에서 #은 인스턴스의 ID 이다. 

server.1=kafka-test-001.epicdevs.com:2888:3888 
server.2=kafka-test-002.epicdevs.com:2888:3888 
server.3=kafka-test-003.epicdevs.com:2888:3888

```



